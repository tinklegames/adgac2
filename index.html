<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="./style.css"/>

    <style>
        canvas:focus {
            outline: none;
        }

        html, body {
            padding: 0;
            margin: 0;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            height: 100%;
        }

        #loading-cover {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 10;
        }

        #unity-loading-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-family: sans-serif;
        }

        #unity-logo img {
            max-width: 180px;
            max-height: 80px;
        }

        #unity-progress-bar-empty {
            width: 220px;
            height: 10px;
            background: #444;
            border-radius: 999px;
            overflow: hidden;
        }

        #unity-progress-bar-full {
            width: 0%;
            height: 100%;
            background: #4af;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 4px solid #444;
            border-top-color: #fff;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>

    <!-- âœ¨ Intro styles (only intro-related additions) -->
    <style>
      #intro-screen {
        position: fixed;
        inset: 0;
        background-color: #414141;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.7s ease, visibility 0.7s ease;
      }

      #intro-screen.hidden-intro {
        opacity: 0;
        visibility: hidden;
      }

      #intro-logo-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: fadeIn 1s ease-out forwards;
      }

      #intro-title {
        font-family: "Orbitron", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        font-size: 42px;
        font-weight: 700;
        letter-spacing: 3px;
        margin-bottom: 20px;
        background: linear-gradient(90deg, #d3a410, #b7870f, #ffe4a1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 8px rgba(211,165,16,0.4));
        opacity: 0;
        animation: titleFade 1s ease forwards 0.4s;
        text-align: center;
      }

      @keyframes titleFade {
        from { opacity: 0; transform: translateY(-12px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      @keyframes bounce {
        0%, 100% { translate: 0px 36px; }
        50%      { translate: 0px 46px; }
      }
      @keyframes bounce2 {
        0%, 100% { translate: 0px 46px; }
        50%      { translate: 0px 56px; }
      }
      @keyframes umbral {
        0%   { stop-color: #d3a5102e; }
        50%  { stop-color: rgba(211,165,16,0.519); }
        100% { stop-color: #d3a5102e; }
      }
      @keyframes particles {
        0%, 100% { translate: 0px 16px; }
        50%      { translate: 0px 6px; }
      }

      #particles {
        animation: particles 4s ease-in-out infinite;
      }
      #animatedStop {
        animation: umbral 4s infinite;
      }
      #bounce {
        animation: bounce 4s ease-in-out infinite;
        translate: 0px 36px;
      }
      #bounce2 {
        animation: bounce2 4s ease-in-out infinite;
        translate: 0px 46px;
        animation-delay: 0.5s;
      }
    </style>
</head>

<body class="dark">
    <!-- âœ¨ Intro overlay (only new markup) -->
    <div id="intro-screen">
      <div id="intro-logo-wrapper">
        <div id="intro-title">Tinkle Games</div>

        <svg xmlns="http://www.w3.org/2000/svg" height="200" width="200">
          <g style="order: -1;">
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="1"
              stroke="#d3a410"
              fill="none"
              points="70,70 148,50 130,130 50,150"
              id="bounce"
            ></polygon>
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="1"
              stroke="#d3a410"
              fill="none"
              points="70,70 148,50 130,130 50,150"
              id="bounce2"
            ></polygon>
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="2"
              stroke=""
              fill="#414750"
              points="70,70 150,50 130,130 50,150"
            ></polygon>
            <polygon
              stroke-width="2"
              stroke=""
              fill="url(#gradiente)"
              points="100,70 150,100 100,130 50,100"
            ></polygon>
            <defs>
              <linearGradient y2="100%" x2="10%" y1="0%" x1="0%" id="gradiente">
                <stop style="stop-color: #1e2026;stop-opacity:1" offset="20%"></stop>
                <stop style="stop-color:#414750;stop-opacity:1" offset="60%"></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="translate(20, 31)"
              stroke-width="2"
              stroke=""
              fill="#b7870f"
              points="80,50 80,75 80,99 40,75"
            ></polygon>
            <polygon
              transform="translate(20, 31)"
              stroke-width="2"
              stroke=""
              fill="url(#gradiente2)"
              points="40,-40 80,-40 80,99 40,75"
            ></polygon>
            <defs>
              <linearGradient y2="100%" x2="0%" y1="-17%" x1="10%" id="gradiente2">
                <stop style="stop-color: #d3a51000;stop-opacity:1" offset="20%"></stop>
                <stop
                  style="stop-color:#d3a51054;stop-opacity:1"
                  offset="100%"
                  id="animatedStop"
                ></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="rotate(180 100 100) translate(20, 20)"
              stroke-width="2"
              stroke=""
              fill="#d3a410"
              points="80,50 80,75 80,99 40,75"
            ></polygon>
            <polygon
              transform="rotate(0 100 100) translate(60, 20)"
              stroke-width="2"
              stroke=""
              fill="url(#gradiente3)"
              points="40,-40 80,-40 80,85 40,110.2"
            ></polygon>
            <defs>
              <linearGradient y2="100%" x2="10%" y1="0%" x1="0%" id="gradiente3">
                <stop style="stop-color: #d3a51000;stop-opacity:1" offset="20%"></stop>
                <stop
                  style="stop-color:#d3a51054;stop-opacity:1"
                  offset="100%"
                ></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="rotate(45 100 100) translate(80, 95)"
              stroke-width="2"
              stroke=""
              fill="#ffe4a1"
              points="5,0 5,5 0,5 0,0"
              id="particles"
            ></polygon>
            <polygon
              transform="rotate(45 100 100) translate(80, 55)"
              stroke-width="2"
              stroke=""
              fill="#ccb069"
              points="6,0 6,6 0,6 0,0"
              id="particles"
            ></polygon>
            <polygon
              transform="rotate(45 100 100) translate(70, 80)"
              stroke-width="2"
              stroke=""
              fill="#fff"
              points="2,0 2,2 0,2 0,0"
              id="particles"
            ></polygon>
            <polygon
              stroke-width="2"
              stroke=""
              fill="#292d34"
              points="29.5,99.8 100,142 100,172 29.5,130"
            ></polygon>
            <polygon
              transform="translate(50, 92)"
              stroke-width="2"
              stroke=""
              fill="#1f2127"
              points="50,50 120.5,8 120.5,35 50,80"
            ></polygon>
          </g>
        </svg>
      </div>
    </div>

    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" tabindex="-1"></canvas>
    </div>

    <div id="loading-cover">
        <div id="unity-loading-bar">
            <div id="unity-logo"><img src="logo.png" alt="logo"/></div>
            <div id="unity-progress-bar-empty" style="display:none;">
                <div id="unity-progress-bar-full"></div>
            </div>
            <div class="spinner"></div>
        </div>
    </div>
<script> 
    // ðŸ”¹ NEW: stub cloudSaves so _InitCloudStorage_js doesn't crash
    var cloudSaves = {
        initialized: true,
        enabled: false,
        data: null,
        // Methods used by typical Yandex-style plugins â€“ safe no-ops / fake success
        load: function () {
            console.log("[cloudSaves] load() stub called");
            return Promise.resolve(null);
        },
        save: function (data) {
            console.log("[cloudSaves] save() stub called with data:", data);
            this.data = data;
            return Promise.resolve();
        },
        remove: function () {
            console.log("[cloudSaves] remove() stub called");
            this.data = null;
            return Promise.resolve();
        }
    };
</script>

    <script>
        // ðŸ”¹ Stub for old Yandex environment hook so Unity JS plugin stops crashing
        var environmentData = {
            lang: (navigator.language || "en").split("-")[0],
            language: (navigator.language || "en").split("-")[0],
            device: /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ? "mobile" : "desktop",
            sdk: "none"
        };

        const hideFullScreenButton = "";
        const buildUrl = "Build";
        const loaderUrl = buildUrl + "/Test.loader.js";
        const config = {
            dataUrl: buildUrl + "/Test.data.gz",
            frameworkUrl: buildUrl + "/Test.framework.js.gz",
            codeUrl: buildUrl + "/Test.wasm.gz",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Mishmek",
            productName: "Polzun",
            productVersion: "1.0.0.0"
        };

        const container = document.querySelector("#unity-container");
        const canvas = document.querySelector("#unity-canvas");
        const loadingCover = document.querySelector("#loading-cover");
        const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
        const progressBarFull = document.querySelector("#unity-progress-bar-full");
        const spinner = document.querySelector(".spinner");

        // Basic mobile handling
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            canvas.style.width = window.innerWidth + "px";
            canvas.style.height = window.innerHeight + "px";
            config.devicePixelRatio = Math.min(window.devicePixelRatio || 1, 2);
        }

        function showUnityWarning(message) {
            console.warn(message);
        }

        let myGameInstance = null;
        let StartUnityInstance = null;

        function StartUnityInstance_IfUnloaded() {
            if (typeof StartUnityInstance === "function" && spinner.style.display !== "none") {
                StartUnityInstance();
            }
        }

        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            StartUnityInstance = function () {
                createUnityInstance(canvas, config, (progress) => {
                    spinner.style.display = "none";
                    progressBarEmpty.style.display = "";
                    progressBarFull.style.width = `${100 * progress}%`;
                }).then((unityInstance) => {
                    myGameInstance = unityInstance;
                    loadingCover.style.display = "none";
                    setTimeout(() => {
        try {
            unityInstance.SendMessage('YandexGame', 'SetLanguage', 'en');
            console.log("[Language] Forced English");
        } catch (e) {
            console.warn("Language set failed:", e);
        }
    }, 500);
                }).catch((message) => {
                    console.error(message);
                    showUnityWarning(message);
                });
            };

            StartUnityInstance_IfUnloaded();
        };
        script.onerror = () => {
            showUnityWarning("Failed to load Unity loader script.");
        };

        document.body.appendChild(script);

        // Stubbed Yandex SDK functions so C#
        function FullAdShow() {
            console.log("FullAdShow stub called (Yandex removed).");
        }

        function RewardedShow(id) {
            console.log("RewardedShow stub called with id:", id, "(Yandex removed).");
            if (myGameInstance && myGameInstance.SendMessage) {
                myGameInstance.SendMessage('YandexGame', 'RewardVideo', 'true');
            }
        }

        function StickyAdActivity(show) {
            console.log("StickyAdActivity stub called:", show, "(Yandex removed).");
        }

        function InitSDK() { console.log("InitSDK stub (Yandex removed)."); }
        function LanguageRequest() {
            console.log("LanguageRequest stub (Yandex removed).");
            if (myGameInstance && myGameInstance.SendMessage) {
                myGameInstance.SendMessage('YandexGame', 'SetLanguage', environmentData.lang);
            }
        }
        function Review() { console.log("Review stub (Yandex removed)."); }
        function PromptShow() { console.log("PromptShow stub (Yandex removed)."); }
        function SetDefaultLeaderboardName(name) { console.log("SetDefaultLeaderboardName stub:", name); }
        function SetLeaderboardScore() { console.log("SetLeaderboardScore stub."); }
        function GetLeaderboardEntries() { console.log("GetLeaderboardEntries stub."); }
        function InitPlayer() { console.log("InitPlayer stub."); }
        function SaveYG() { console.log("SaveYG stub."); }
        function LoadYG() { console.log("LoadYG stub."); }
        function RemoveSavesYandex() { console.log("RemoveSavesYandex stub."); }
        function BuyPayments(id) { console.log("BuyPayments stub:", id); }
        function YandexPayments() { console.log("YandexPayments stub."); }
    </script>

    <!-- âœ¨ Intro hide script (only for intro) -->
    <script>
      window.addEventListener("load", () => {
        const intro = document.getElementById("intro-screen");
        if (!intro) return;
        setTimeout(() => {
          intro.classList.add("hidden-intro");
          setTimeout(() => intro.remove(), 800);
        }, 2500);
      });
    </script>
</body>
</html>
